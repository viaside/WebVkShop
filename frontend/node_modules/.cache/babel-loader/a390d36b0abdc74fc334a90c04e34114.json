{"ast":null,"code":"var _jsxFileName = \"D:\\\\\\u041F\\u0440\\u043E\\u0435\\u043A\\u0442\\u044B\\\\shop\\\\src\\\\services\\\\VkAuth.js\",\n  _s = $RefreshSig$();\nimport React from \"react\";\nimport { withRouter, RouteComponentProps } from \"react-router-dom\";\nimport queryString from \"query-string\";\nimport { isEmptyObj } from \"helpers/isEmptyObj\";\nimport UserStore from \"stores/UserStore\";\nimport vk from \"./img/VK_Blue_Logo.svg\";\nimport styles from \"./VKButton.module.scss\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst VKButton = props => {\n  _s();\n  const [isError, setIsError] = React.useState(false);\n  const host = process.env.REACT_APP_MODE === \"production\" ? process.env.REACT_APP_HOST_PROD : process.env.REACT_APP_HOST_LOCAL;\n  const cbLink = `${host}/signin`;\n  const handleRedirect = () => {\n    window.location.href = `https://oauth.vk.com/authorize?client_id=${process.env.REACT_APP_CLIENT_ID}&display=popup&redirect_uri=${cbLink}&scope=email&response_type=code&v=5.120&state=4194308`;\n  };\n  React.useEffect(() => {\n    const handleLogin = code => {\n      UserStore.loginVk(code).then(() => {\n        props.history.push(\"/user\");\n      }).catch(() => setIsError(true));\n    };\n    let queryObj = queryString.parse(props.location.search);\n    if (isError) window.location.href = cbLink;\n    if (!isEmptyObj(queryObj) && queryObj[\"code\"]) handleLogin(queryObj.code);\n  }, [props.location.search, isError, cbLink, props.history]);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: styles[\"vk-button\"],\n    children: [/*#__PURE__*/_jsxDEV(\"button\", {\n      className: styles[\"vk-button__input\"],\n      onClick: handleRedirect,\n      children: [/*#__PURE__*/_jsxDEV(\"img\", {\n        src: vk,\n        alt: \"vk logo\",\n        className: styles[\"vk-button__input-icon\"]\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 47,\n        columnNumber: 9\n      }, this), \"\\u0412\\u043E\\u0439\\u0442\\u0438 \\u0447\\u0435\\u0440\\u0435\\u0437 \\u0412\\u043A\\u043E\\u043D\\u0442\\u0430\\u043A\\u0442\\u0435\"]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 46,\n      columnNumber: 7\n    }, this), isError && /*#__PURE__*/_jsxDEV(\"p\", {\n      style: {\n        color: \"red\"\n      },\n      children: \"\\u041E\\u0448\\u0438\\u0431\\u043A\\u0430 \\u0432\\u0445\\u043E\\u0434\\u0430 \\u0447\\u0435\\u0440\\u0435\\u0437 \\u0412\\u041A\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 54,\n      columnNumber: 19\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 45,\n    columnNumber: 5\n  }, this);\n};\n_s(VKButton, \"cYtCuFVqYRooso/pQ7uSe329yq0=\");\n_c = VKButton;\nexport default _c2 = withRouter(VKButton);\nvar _c, _c2;\n$RefreshReg$(_c, \"VKButton\");\n$RefreshReg$(_c2, \"%default%\");","map":{"version":3,"names":["React","withRouter","RouteComponentProps","queryString","isEmptyObj","UserStore","styles","VKButton","props","isError","setIsError","useState","host","process","env","REACT_APP_MODE","REACT_APP_HOST_PROD","REACT_APP_HOST_LOCAL","cbLink","handleRedirect","window","location","href","REACT_APP_CLIENT_ID","useEffect","handleLogin","code","loginVk","then","history","push","catch","queryObj","parse","search","vk","color"],"sources":["D:/Проекты/shop/src/services/VkAuth.js"],"sourcesContent":["import React from \"react\";\nimport { withRouter, RouteComponentProps } from \"react-router-dom\";\nimport queryString from \"query-string\";\n\nimport { isEmptyObj } from \"helpers/isEmptyObj\";\nimport UserStore from \"stores/UserStore\";\n\nimport vk from \"./img/VK_Blue_Logo.svg\";\n\nimport styles from \"./VKButton.module.scss\";\n\ninterface IProps extends RouteComponentProps {}\n\nconst VKButton: React.FC<IProps> = (props) => {\n  const [isError, setIsError] = React.useState(false);\n\n  const host =\n    process.env.REACT_APP_MODE === \"production\"\n      ? process.env.REACT_APP_HOST_PROD\n      : process.env.REACT_APP_HOST_LOCAL;\n\n  const cbLink = `${host}/signin`;\n\n  const handleRedirect = () => {\n    window.location.href = `https://oauth.vk.com/authorize?client_id=${process.env.REACT_APP_CLIENT_ID}&display=popup&redirect_uri=${cbLink}&scope=email&response_type=code&v=5.120&state=4194308`;\n  };\n\n  React.useEffect(() => {\n    const handleLogin = (code: string) => {\n      UserStore.loginVk(code)\n        .then(() => {\n          props.history.push(\"/user\");\n        })\n        .catch(() => setIsError(true));\n    };\n\n    let queryObj = queryString.parse(props.location.search);\n\n    if (isError) window.location.href = cbLink;\n\n    if (!isEmptyObj(queryObj) && queryObj[\"code\"]) handleLogin(queryObj.code);\n  }, [props.location.search, isError, cbLink, props.history]);\n\n  return (\n    <div className={styles[\"vk-button\"]}>\n      <button className={styles[\"vk-button__input\"]} onClick={handleRedirect}>\n        <img\n          src={vk}\n          alt=\"vk logo\"\n          className={styles[\"vk-button__input-icon\"]}\n        />\n        Войти через Вконтакте\n      </button>\n      {isError && <p style={{ color: \"red\" }}>Ошибка входа через ВК</p>}\n    </div>\n  );\n};\n\nexport default withRouter(VKButton);"],"mappings":";;AAAA,OAAOA,KAAK,MAAM,OAAO;AACzB,SAASC,UAAU,EAAEC,mBAAmB,QAAQ,kBAAkB;AAClE,OAAOC,WAAW,MAAM,cAAc;AAEtC,SAASC,UAAU,QAAQ,oBAAoB;AAC/C,OAAOC,SAAS,MAAM,kBAAkB;AAAC;AAIzC,OAAOC,MAAM,MAAM,wBAAwB;AAAC;AAI5C,MAAMC,QAA0B,GAAIC,KAAK,IAAK;EAAA;EAC5C,MAAM,CAACC,OAAO,EAAEC,UAAU,CAAC,GAAGV,KAAK,CAACW,QAAQ,CAAC,KAAK,CAAC;EAEnD,MAAMC,IAAI,GACRC,OAAO,CAACC,GAAG,CAACC,cAAc,KAAK,YAAY,GACvCF,OAAO,CAACC,GAAG,CAACE,mBAAmB,GAC/BH,OAAO,CAACC,GAAG,CAACG,oBAAoB;EAEtC,MAAMC,MAAM,GAAI,GAAEN,IAAK,SAAQ;EAE/B,MAAMO,cAAc,GAAG,MAAM;IAC3BC,MAAM,CAACC,QAAQ,CAACC,IAAI,GAAI,4CAA2CT,OAAO,CAACC,GAAG,CAACS,mBAAoB,+BAA8BL,MAAO,uDAAsD;EAChM,CAAC;EAEDlB,KAAK,CAACwB,SAAS,CAAC,MAAM;IACpB,MAAMC,WAAW,GAAIC,IAAY,IAAK;MACpCrB,SAAS,CAACsB,OAAO,CAACD,IAAI,CAAC,CACpBE,IAAI,CAAC,MAAM;QACVpB,KAAK,CAACqB,OAAO,CAACC,IAAI,CAAC,OAAO,CAAC;MAC7B,CAAC,CAAC,CACDC,KAAK,CAAC,MAAMrB,UAAU,CAAC,IAAI,CAAC,CAAC;IAClC,CAAC;IAED,IAAIsB,QAAQ,GAAG7B,WAAW,CAAC8B,KAAK,CAACzB,KAAK,CAACa,QAAQ,CAACa,MAAM,CAAC;IAEvD,IAAIzB,OAAO,EAAEW,MAAM,CAACC,QAAQ,CAACC,IAAI,GAAGJ,MAAM;IAE1C,IAAI,CAACd,UAAU,CAAC4B,QAAQ,CAAC,IAAIA,QAAQ,CAAC,MAAM,CAAC,EAAEP,WAAW,CAACO,QAAQ,CAACN,IAAI,CAAC;EAC3E,CAAC,EAAE,CAAClB,KAAK,CAACa,QAAQ,CAACa,MAAM,EAAEzB,OAAO,EAAES,MAAM,EAAEV,KAAK,CAACqB,OAAO,CAAC,CAAC;EAE3D,oBACE;IAAK,SAAS,EAAEvB,MAAM,CAAC,WAAW,CAAE;IAAA,wBAClC;MAAQ,SAAS,EAAEA,MAAM,CAAC,kBAAkB,CAAE;MAAC,OAAO,EAAEa,cAAe;MAAA,wBACrE;QACE,GAAG,EAAEgB,EAAG;QACR,GAAG,EAAC,SAAS;QACb,SAAS,EAAE7B,MAAM,CAAC,uBAAuB;MAAE;QAAA;QAAA;QAAA;MAAA,QAC3C;IAAA;MAAA;MAAA;MAAA;IAAA,QAEK,EACRG,OAAO,iBAAI;MAAG,KAAK,EAAE;QAAE2B,KAAK,EAAE;MAAM,CAAE;MAAA;IAAA;MAAA;MAAA;MAAA;IAAA,QAA0B;EAAA;IAAA;IAAA;IAAA;EAAA,QAC7D;AAEV,CAAC;AAAC,GA3CI7B,QAA0B;AAAA,KAA1BA,QAA0B;AA6ChC,qBAAeN,UAAU,CAACM,QAAQ,CAAC;AAAC;AAAA;AAAA"},"metadata":{},"sourceType":"module"}