{"ast":null,"code":"var _jsxFileName = \"D:\\\\\\u041F\\u0440\\u043E\\u0435\\u043A\\u0442\\u044B\\\\shop\\\\src\\\\services\\\\vkAuthPopup.js\",\n  _s = $RefreshSig$();\nimport { useEffect } from 'react';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst OAUTH_STATE_KEY = 'react-use-oauth2-state-key';\nconst OAUTH_RESPONSE = 'react-use-oauth2-response';\nconst checkState = receivedState => {\n  const state = sessionStorage.getItem(OAUTH_STATE_KEY);\n  return state === receivedState;\n};\nconst queryToObject = query => {\n  const parameters = new URLSearchParams(query);\n  return Object.fromEntries(parameters.entries());\n};\nconst OAuthPopup = props => {\n  _s();\n  const {\n    Component = /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        margin: '12px'\n      },\n      \"data-testid\": \"popup-loading\",\n      children: \"Loading...\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 19,\n      columnNumber: 4\n    }, this)\n  } = props;\n\n  // On mount\n  useEffect(() => {\n    const payload = queryToObject(window.location.search.split('?')[1]);\n    const state = payload && payload.state;\n    const error = payload && payload.error;\n    if (!window.opener) {\n      throw new Error('No window opener');\n    }\n    if (error) {\n      window.opener.postMessage({\n        type: OAUTH_RESPONSE,\n        error: decodeURI(error) || 'OAuth error: An error has occured.'\n      });\n    } else if (state && checkState(state)) {\n      window.opener.postMessage({\n        type: OAUTH_RESPONSE,\n        payload\n      });\n    } else {\n      window.opener.postMessage({\n        type: OAUTH_RESPONSE,\n        error: 'OAuth error: State mismatch.'\n      });\n    }\n  }, []);\n  return Component;\n};\n_s(OAuthPopup, \"OD7bBpZva5O2jO+Puf00hKivP7c=\");\n_c = OAuthPopup;\nexport default OAuthPopup;\nvar _c;\n$RefreshReg$(_c, \"OAuthPopup\");","map":{"version":3,"names":["useEffect","OAUTH_STATE_KEY","OAUTH_RESPONSE","checkState","receivedState","state","sessionStorage","getItem","queryToObject","query","parameters","URLSearchParams","Object","fromEntries","entries","OAuthPopup","props","Component","margin","payload","window","location","search","split","error","opener","Error","postMessage","type","decodeURI"],"sources":["D:/Проекты/shop/src/services/vkAuthPopup.js"],"sourcesContent":["import { useEffect } from 'react';\r\n\r\nconst OAUTH_STATE_KEY = 'react-use-oauth2-state-key';\r\nconst OAUTH_RESPONSE = 'react-use-oauth2-response';\r\n\r\nconst checkState = (receivedState) => {\r\n\tconst state = sessionStorage.getItem(OAUTH_STATE_KEY);\r\n\treturn state === receivedState;\r\n};\r\n\r\nconst queryToObject = (query) => {\r\n\tconst parameters = new URLSearchParams(query);\r\n\treturn Object.fromEntries(parameters.entries());\r\n};\r\n\r\nconst OAuthPopup = (props) => {\r\n\tconst {\r\n\t\tComponent = (\r\n\t\t\t<div style={{ margin: '12px' }} data-testid=\"popup-loading\">\r\n\t\t\t\tLoading...\r\n\t\t\t</div>\r\n\t\t),\r\n\t} = props;\r\n\r\n\t// On mount\r\n\tuseEffect(() => {\r\n\t\tconst payload = queryToObject(window.location.search.split('?')[1]);\r\n\t\tconst state = payload && payload.state;\r\n\t\tconst error = payload && payload.error;\r\n\r\n\t\tif (!window.opener) {\r\n\t\t\tthrow new Error('No window opener');\r\n\t\t}\r\n\r\n\t\tif (error) {\r\n\t\t\twindow.opener.postMessage({\r\n\t\t\t\ttype: OAUTH_RESPONSE,\r\n\t\t\t\terror: decodeURI(error) || 'OAuth error: An error has occured.',\r\n\t\t\t});\r\n\t\t} else if (state && checkState(state)) {\r\n\t\t\twindow.opener.postMessage({\r\n\t\t\t\ttype: OAUTH_RESPONSE,\r\n\t\t\t\tpayload,\r\n\t\t\t});\r\n\t\t} else {\r\n\t\t\twindow.opener.postMessage({\r\n\t\t\t\ttype: OAUTH_RESPONSE,\r\n\t\t\t\terror: 'OAuth error: State mismatch.',\r\n\t\t\t});\r\n\t\t}\r\n\t}, []);\r\n\r\n\treturn Component;\r\n};\r\n\r\nexport default OAuthPopup;"],"mappings":";;AAAA,SAASA,SAAS,QAAQ,OAAO;AAAC;AAElC,MAAMC,eAAe,GAAG,4BAA4B;AACpD,MAAMC,cAAc,GAAG,2BAA2B;AAElD,MAAMC,UAAU,GAAIC,aAAa,IAAK;EACrC,MAAMC,KAAK,GAAGC,cAAc,CAACC,OAAO,CAACN,eAAe,CAAC;EACrD,OAAOI,KAAK,KAAKD,aAAa;AAC/B,CAAC;AAED,MAAMI,aAAa,GAAIC,KAAK,IAAK;EAChC,MAAMC,UAAU,GAAG,IAAIC,eAAe,CAACF,KAAK,CAAC;EAC7C,OAAOG,MAAM,CAACC,WAAW,CAACH,UAAU,CAACI,OAAO,EAAE,CAAC;AAChD,CAAC;AAED,MAAMC,UAAU,GAAIC,KAAK,IAAK;EAAA;EAC7B,MAAM;IACLC,SAAS,gBACR;MAAK,KAAK,EAAE;QAAEC,MAAM,EAAE;MAAO,CAAE;MAAC,eAAY,eAAe;MAAA;IAAA;MAAA;MAAA;MAAA;IAAA;EAI7D,CAAC,GAAGF,KAAK;;EAET;EACAhB,SAAS,CAAC,MAAM;IACf,MAAMmB,OAAO,GAAGX,aAAa,CAACY,MAAM,CAACC,QAAQ,CAACC,MAAM,CAACC,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC;IACnE,MAAMlB,KAAK,GAAGc,OAAO,IAAIA,OAAO,CAACd,KAAK;IACtC,MAAMmB,KAAK,GAAGL,OAAO,IAAIA,OAAO,CAACK,KAAK;IAEtC,IAAI,CAACJ,MAAM,CAACK,MAAM,EAAE;MACnB,MAAM,IAAIC,KAAK,CAAC,kBAAkB,CAAC;IACpC;IAEA,IAAIF,KAAK,EAAE;MACVJ,MAAM,CAACK,MAAM,CAACE,WAAW,CAAC;QACzBC,IAAI,EAAE1B,cAAc;QACpBsB,KAAK,EAAEK,SAAS,CAACL,KAAK,CAAC,IAAI;MAC5B,CAAC,CAAC;IACH,CAAC,MAAM,IAAInB,KAAK,IAAIF,UAAU,CAACE,KAAK,CAAC,EAAE;MACtCe,MAAM,CAACK,MAAM,CAACE,WAAW,CAAC;QACzBC,IAAI,EAAE1B,cAAc;QACpBiB;MACD,CAAC,CAAC;IACH,CAAC,MAAM;MACNC,MAAM,CAACK,MAAM,CAACE,WAAW,CAAC;QACzBC,IAAI,EAAE1B,cAAc;QACpBsB,KAAK,EAAE;MACR,CAAC,CAAC;IACH;EACD,CAAC,EAAE,EAAE,CAAC;EAEN,OAAOP,SAAS;AACjB,CAAC;AAAC,GAtCIF,UAAU;AAAA,KAAVA,UAAU;AAwChB,eAAeA,UAAU;AAAC;AAAA"},"metadata":{},"sourceType":"module"}